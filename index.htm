<!DOCTYPE html>
<html>

<head>
    <link href="css/style.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <title>jQuery Multi-Step Form Example</title>
</head>

<body>
    </head>

    <body>
        <div id="wrapper">
            <div class="header">
                <div class="header__wrapper">
                    <a href="https://www.currencyfair.com/"><img src="images/CF_logo_RGB_NEG.svg" alt="logo-currencyfair-pos" class="header__logo"></a>
                </div>
            </div>
            <div id="page-content-wrapper">
                <div class="container-fluid">
                    <div class="form-wrapper topSpacer">
                        <!-- progressbar -->
                        <ul id="progressbar">
                            <li class="active"><span><span class="steps">Step 1</span>
                                <br />Transaction Info</span>
                            </li>
                            <li><span><span class="steps">Step 2</span>
                                <br />Recipient Info</span>
                            </li>
                            <li><span><span class="steps">Step 3</span>
                                <br />Make Paymeny</span>
                            </li>
                        </ul>
                        <!-- multistep form -->
                        <form id="msform" class="multistep-form">
                            <!-- fieldsets -->
                            <fieldset>
                                <h3 class="title">Let's set up a transaction!</h3>
                                <p>Specify the amount to be sent or received.</p>
                                <div class="inputWrap">
                                    <div class="field-boxed-wrapper">
                                        <div class="field-boxed-header">
                                            <label class="field-box-label label-active">
                                                YOU SEND</label>
                                        </div>
                                        <div class="field-note-wrapper">
                                            <input type="text" id="inputFirst" value="2000" class="field-grouped no-rounded-bottom field-boxed field-masked" data-input="1">
                                            <div class="field-addon__item field-addon__item--after">
                                                <div class="field-addon-wrapper">
                                                    <div class="select-custom">
                                                        <select class="field-addon-before rounded-left " id="selectFirst" data-input="1">
                                                        </select>
                                                    </div>
                                                    <div class="field-addon__item field-addon__item--before field-addon__item--before-s">
                                                        <img src="images/eur.png" alt="gbp currency" class="flag">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="field-masked-label money-label">
                                                <span class="whole">د.إ 5,000</span><span class="font-size-h4 decimal">.00</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="field-boxed-wrapper">
                                        <div class="field-boxed-header">
                                            <label class="field-box-label label-inactive">RECIPIENT GETS</label>
                                        </div>
                                        <div class="field-masked-wrapper field-addon-wrapper">
                                            <input type="text" id="inputSecond" value="0" class="field-grouped field-boxed no-rounded-top horizontal-overlap-border field-masked" data-input="2">
                                            <div class="field-addon__item field-addon__item--after">
                                                <div class="field-addon-wrapper">
                                                    <div class="select-custom">
                                                        <select class="font-family-post-grotesk-medium font-size-h5-palm field-addon-before rounded-left" id="selectSecond" data-input="2">
                                                        </select>
                                                    </div>
                                                    <div class="field-addon__item field-addon__item--before field-addon__item--before-s field-addon__item--not-interactive">
                                                        <img src="images/gbp.png" alt="gbp currency" class="flag">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="field-masked-label money-label">
                                                <span class="whole">$ 1,756</span><span class="font-size-h4 decimal">.20</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <input type="button" name="next" class="next action-button" data="modal" value="Next" />
                            </fieldset>
                            <fieldset class="input-horizontal">
                                <h3 class="title">Recipient Info</h3>
                                <p>Enter details of account you want to transfer your money out to:</p>
                                <div class="inputWrap">
                                    <div>
                                        <input type="text" placeholder="Account name" id="account">
                                    </div>
                                    <div>
                                        <input type="text" placeholder="Bank name" id="bank">
                                    </div>
                                    <div>
                                        <input type="text" placeholder="Bank Account Number" id="bank">
                                    </div>
                                    <div>
                                        <input type="text" placeholder="Bank name" id="iban">
                                    </div>
                                </div>
                                <input type="button" name="previous" class="previous action-button" value="Previous" />
                                <input type="button" name="next" class="next action-button" value="Next" />
                            </fieldset>
                            <fieldset class="input-horizontal">
                                <h3 class="title">Payment Details</h3>
                                <p>Please enter payment details</p>
                                <div class="inputWrap">
                                    <!-- Name -->
                                    <div class="control-group">
                                        <label class="control-label" for="username">Card Holder's Name</label>
                                        <div class="controls">
                                            <input type="text" id="username" name="username" placeholder="" class="input-xlarge">
                                        </div>
                                    </div>
                                    <!-- Card Number -->
                                    <div class="control-group">
                                        <label class="control-label" for="email">Card Number</label>
                                        <div class="controls">
                                            <input type="text" id="email" name="email" placeholder="" class="input-xlarge">
                                        </div>
                                    </div>
                                    <!-- Expiry-->
                                    <div class="control-group">
                                        <label class="control-label" for="password">Card Expiry Date</label>
                                        <div class="expiry-controls">
                                            <select class="span3" name="expiry_month" id="expiry_month">
                                                <option></option>
                                                <option value="01">Jan (01)</option>
                                                <option value="02">Feb (02)</option>
                                                <option value="03">Mar (03)</option>
                                                <option value="04">Apr (04)</option>
                                                <option value="05">May (05)</option>
                                                <option value="06">June (06)</option>
                                                <option value="07">July (07)</option>
                                                <option value="08">Aug (08)</option>
                                                <option value="09">Sep (09)</option>
                                                <option value="10">Oct (10)</option>1
                                                <option value="11">Nov (11)</option>
                                                <option value="12">Dec (12)</option>
                                            </select>
                                            <select class="span2" name="expiry_year">
                                                <option value="13">2013</option>
                                                <option value="14">2014</option>
                                                <option value="15">2015</option>
                                                <option value="16">2016</option>
                                                <option value="17">2017</option>
                                                <option value="18">2018</option>
                                                <option value="19">2019</option>
                                                <option value="20">2020</option>
                                                <option value="21">2021</option>
                                                <option value="22">2022</option>
                                                <option value="23">2023</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div style="clear:both"></div>
                                    <!-- CVV -->
                                    <div class="control-group">
                                        <label class="control-label" for="password_confirm">Card CVV</label>
                                        <div class="controls">
                                            <input type="password" id="password_confirm" name="password_confirm" placeholder="" class="span2">
                                        </div>
                                    </div>
                                </div>
                                <input type="button" name="previous" class="previous action-button" value="Previous" />
                                <input type="submit" name="submit" class="submit action-button" value="Submit" />
                            </fieldset>
                            <div class="footer">
                                <div class="footer-inside border-top">
                                    <p>&copy; 2016 CurrencyFair
                                        <span class="pull-right">
						<a href="url" class="inline-link">Help & Support   </a>
						<a href="url" class="inline-link">Legal Stuff</a>
					</span>
                                    </p>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <!-- Sidebar -->
            <div id="sidebar-wrapper" class="border panel-bg-color">
                <div class="panel topSpacer">
                    <ul class="list-group border rounded">
                        <li class="list-group-item border-bottom list-header panel-bg-color"><strong>Sending Details</strong></li>
                        <li class="list-group-item border-bottom panel-row-bg-white">You Send
                            <span id="panelAmountSent" class="badge badge-success amount">£2000</span>
                        </li>
                        <li class="list-group-item border-bottom list-header panel-bg-color">
                            <strong>Receiving Details</strong>
                            <span class="badge badge-note"><a>As of righth now </a></span>
                        </li>
                        <li class="list-group-item panel-row-bg-white" id="rate">Rate
                            <span class="badge badge-warning"> 4 </span>
                        </li>
                        <li class="list-group-item panel-row-bg-white" id="fee">Fee
                            <span class="badge badge-info"> £2.50 </span>
                        </li>
                        <li class="list-group-item panel-row-bg-white" id="del_date">Delivery date
                            <span class="badge badge-info"> 25th November </span>
                        </li>
                        <li class="list-group-item border-bottom panel-row-bg-white" id="amount_received">Recipient gets
                            <span class="badge badge-info amount"> £3000 </span>
                        </li>
                        <li class="list-group-item notice">You save £66.19 compared your bank!
                        </li>
                    </ul>
                </div>
            </div>
            <!-- /#sidebar-wrapper -->
            <div id="modal" class="inactive"></div>
            <div class="modalContent inactive">
                <div class="modalContentWrapper">
                    <h3 class="modalHeader"><i class="material-icons">lock</i>Identity verification required</h3>
                    <p>For your security, we ocassionally require you to verify your identity by entering a code sent to your mobile device.</p>
                </div>
                <form id="verifyDigit" action="" class="f1">
                    <div class="modalPanel panel-bg-color">
                        <h3 class="sms">Enter the code sent via SMS to    
						  <span class="prefix rounded-left border">+353</span>
						  <span class="mobile-number rounded-right border">872251177</span>
					  </h3>
                        <div class="digitWrap">
                            <div class="digit-flex">
                                <input id="1" name="digit" class="digit" type="text" maxlength="1" size="1" value="">
                                <input id="2" name="digit" class="digit" type="text" maxlength="1" size="1" value="">
                                <input id="3" name="digit" class="digit" type="text" maxlength="1" size="1" value="">
                                <input id="4" name="digit" class="digit" type="text" maxlength="1" size="1" value="">
                                <input id="5" name="digit" class="digit" type="text" maxlength="1" size="1" value="">
                                <input id="6" name="digit" class="digit" type="text" maxlength="1" size="1" value="">
                                <p class="small-text refresh"><i class="material-icons blue-text">refresh</i> Receive a new code</p>
                                <p class="small-text call"><i class="material-icons blue-text">call</i> Receive code via call instead</p>
                            </div>
                        </div>
                    </div>
                    <div class="test small-text" style="color:red;position:absolute">PIN test: 123456</div>
                </form>
                <div class="modalContentWrapper modal-bottom">
                    <a type="submit" name="submit" class="submit verify action-button ">Verify Idenity </a>
                    <input type="button" name="previous" class="back action-button" value="Back" />
                    <!-- 						<button id="b1" class="b1">Serialize form values</button> -->
                    <p class="blue-text small-text mobile-device-text">I can't access this mobile device.</p>
                    
                </div>
            </div>
            
        </div>
        <!-- jQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <!-- jQuery easing plugin -->
        <script src="js/jquery.easing.min.js" type="text/javascript"></script>
        <script src="js/featherlight.min.js" type="text/javascript"></script>
        <script>
        var data = {};

        $.getJSON("data.json", function(res) {
            data = res;
        });


        $(function() {

            var select = $("#selectFirst, #selectSecond");
            var input = $('#inputFirst, #inputSecond');
            var moneyLabel = $('.money-label');

			$.each(data.currency, function(key, value) {
                select.append('<option value=' + key + '>' + key + '</option>');
            });

            // initialize selected states

            $(select[0]).find('option').eq(0).attr('selected', true);
            $(select[1]).find('option').eq(2).attr('selected', true);

            requestCurrencyRatesAPI(1);


            input.keyup(function() {
                var firstInput;
                if ($(this).attr('data-input') == 1)
                    firstInput = 1;
                else
                    firstInput = 0;
                requestCurrencyRatesAPI(firstInput);
            });

            var prevSelected;

            select.on('focus', function() {

                // Store the current value on focus and on change
                prevSelected = this.value;


            }).change(function() {
                var firstInput;
                // get selected option
                var optionSelected = $("option:selected", this);
                var valueSelected = this.value;
                var imgSrc = data.currency[valueSelected].img;


                // update flag in selected field
                select.filter($(this)).parent().next().find('.flag').attr("src", imgSrc);

				// check for the same values selecled in both lists
                if ($(select[0]).val() == valueSelected && $(select[1]).val() == valueSelected) {
                    console.log('the same');
                    // swap other list dropdown with prevbiously selected value
                    select.not($(this)).val(prevSelected);

					// update other input flag
                    imgSrc = data.currency[prevSelected].img;
                    select.not($(this)).parent().next().find('.flag').attr("src", imgSrc);

                    // swap inpu values
                    var inputSwap = $(input[0]).val();
                    $(input[0]).val($(input[1]).val());
                    $(input[1]).val(inputSwap);

                    // remove focus in order to re-focus on 
                    select.blur();
                }

                // remove all other selected attribute for current list
                select.filter($(this)).find('option').removeAttr('selected');

				// determine whether first or second dropdown list
                if ($(this).attr('data-input') == 1)
                    firstInput = 1;
                else
                    firstInput = 0;


				// added selected attribute to selected option
                optionSelected.attr('selected', true);

                requestCurrencyRatesAPI(firstInput);
            });


            function inputUpdate(elIndex) {

                var rate, amountFirst, amountSecond, base, to;



                base = $("#selectFirst").val();
                to = $("#selectSecond").val();
                rate = data.currency[base].rate[to];
                amountFirst = $('#inputFirst').val();
                amountSecond = $('#inputSecond').val((rate * amountFirst).toFixed(2));

            }

             function formatCurrency(value, base, elNum) {
                
                select.each(function(){

                });
                jQuery.each( array, callback )
            	
             	var sym = data.currency[base].symbol
           

               $(moneyLabel[elNum]).html(sym + value);
           
            }




            function requestCurrencyRatesAPI(firstInput) {

                var rate, amountFirst, amountSecond, base, to;

                // var result = input ? 1 : 0;


                // base = $(select[!result]).val();
                // to = $(select[result]).val();

                //swap inputs if the same selected


                if (firstInput) {
                    base = $(select[0]).val();
                    to = $(select[1]).val();
                    rate = data.currency[base].rate[to];
                    $('#rate').find('span').html(rate);
                    amountFirst = $(input[0]).val();
               
                    amountSecond = $(input[1]).val((rate * amountFirst).toFixed(2));
                    formatCurrency(amountFirst, base, 0);
                    
                } else {
                    base = $(select[1]).val();
                    to = $(select[0]).val();
                    rate = data.currency[base].rate[to];
                    $('#rate').find('span').html(rate);
                    amountSecond = $(input[1]).val();
                    amountFirst = $(input[0]).val((rate * amountSecond).toFixed(2));
                    formatCurrency(amountSecond, base);
                }

			}


            

        });




        $(function() {
            var fxHandler = function(e) {

                //this.value = this.value.replace(/[^0-9\.]/g,'');
                $(this).val($(this).val().replace(/[^0-9\.]/g, ''));
                if ((event.which != 46 || $(this).val().indexOf('.') != -1) && (event.which < 48 || event.which > 57)) {
                    event.preventDefault();
                }

                $('#panelAmountSent').html(e.target.value)
            };

            // bind to whatever events you need
            $('#amountSent').bind('keyup', fxHandler);
        });



		$(function() {

            var userPINentered = '';

            var userPIN = data.user[0].pin;
            var testPIN = '<p style="color:red">testPIN: <span>'+ userPIN + '</span></p>';

            // PIN from json data	
            $('.test').html(testPIN);

            //jQuery time
            var current_fs, next_fs, previous_fs; //fieldsets
            var left, opacity, scale; //fieldset properties which we will animate
            var animating; //flag to prevent quick multi-click glitches


			var currentDigit, currentDigitIsEmpty,
                digits = $(".digit");

            var preVal;

			digits.click(function() {

				currentDigit = $(this);
                preVal = currentDigit.val();
                currentDigitIsEmpty = currentDigit.val().length === 0;



                // if not empty remove value in field
                if (!currentDigitIsEmpty) {

                    //reinstate number when moved out of focus without key event


                    currentDigit.val('');
                    // reinstate number when moved out of focus without key event
                    // $(".digit").blur(function(){
                    // 	currentDigit.val(currentDigit.val());
                    // });
                }

            });


            digits.blur(function() {
                prevDigit = $(this);
                if (prevDigit.val().length === 0) {


                    prevDigit.val(preVal);
                }

            });







            digits.keyup(function(e) {
                e.preventDefault();
                currentDigit = $(this);

                currentDigit.val(currentDigit.val())

                if (this.value.length == this.maxLength) {
                    currentDigitnxt = currentDigit.next('.digit');
                    // less than 6 digits



                    if (currentDigit.index() < (digits.length - 1)) {
                        if (currentDigitnxt.val().length === 0)
                            currentDigitnxt.focus();
                    }
                }
            })





            $(".next").click(function() {
                if (animating) return false;
                animating = true;

                var nextButton = $(this);

                current_fs = $(this).parent();
                next_fs = $(this).parent().next();
                var modal = false;

                if (nextButton.attr('data') == 'modal') {
                    modal = 'modalInit';
                    var modalContent = $('.modalContent');



                    $.featherlight(modalContent, {
                        closeOnClick: false,
                        otherClose: '.back',
                        closeOnEsc: false,
                        closeIcon: null,
                        // targetAttr:    'modal'  
                        afterClose: function() {

                            // so modal will pop up after clicking back button
                            animating = false;
                        }

                    });
                }



                //hide the current fieldset with style
                var animate = current_fs.animate({
                    opacity: 0
                }, {

                    step: function(now, mx) {
                        //activate next step on progressbar using the index of next_fs
                        $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");

                        //$("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");
                        //show the next fieldset
                        next_fs.show();
                        //as the opacity of current_fs reduces to 0 - stored in "now"
                        //1. scale current_fs down to 80%
                        scale = 1 - (1 - now) * 0.1;
                        //2. bring next_fs from the right(50%)
                        left = (now * 50) + "%";
                        //3. increase opacity of next_fs to 1 as it moves in
                        opacity = 1 - now;
                        current_fs.css({
                            'transform': 'scale(' + scale + ')'
                        });
                        next_fs.css({
                            'left': left,
                            'opacity': opacity
                        });
                    },
                    progress: function() {
                        console.log('progress');
                    },
                    queue: modal,
                    duration: 800,
                    complete: function() {
                        current_fs.hide();
                        animating = false;
                        // remove modal once verified
                        nextButton.removeAttr('data');
                    },
                    //this comes from the custom easing plugin
                    easing: 'easeInOutBack'
                });

                // $(".back").click(function(){
                // 	animate.clearQueue("modalInit");
                //  });

                $(function() {

                    $(".verify").click(function() {
                        // get digits enter from verify pin form
                        var verified = false;
                        var x = $(this).parent().prev("form").serializeArray();
                        var currentModal = $.featherlight.current();

                        $.each(x, function(i, field) {
                            userPINentered += field.value;
                        });

                        verified = userPIN == userPINentered;


                        console.log(userPINentered);


                        if (verified) {
                            $(".verify").append('<i class="material-icons right">done</i>');
                            setTimeout(function() {
                                animate.dequeue("modalInit");
                                currentModal.close();
                            }, 1200);

                        }

                        userPINentered = '';

                        console.log(userPINentered + " entered");
                    });
                });




            });



            $(".previous").click(function() {
                if (animating) return false;
                animating = true;

                current_fs = $(this).parent();
                previous_fs = $(this).parent().prev();

                //de-activate current step on progressbar
                $("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");

                //show the previous fieldset
                previous_fs.show();
                //hide the current fieldset with style
                current_fs.animate({
                    opacity: 0
                }, {
                    step: function(now, mx) {
                        //as the opacity of current_fs reduces to 0 - stored in "now"
                        //1. scale previous_fs from 80% to 100%
                        scale = 0.8 + (1 - now) * 0.2;
                        //2. take current_fs to the right(50%) - from 0%
                        left = ((1 - now) * 50) + "%";
                        //3. increase opacity of previous_fs to 1 as it moves in
                        opacity = 1 - now;
                        current_fs.css({
                            'left': left
                        });
                        previous_fs.css({
                            'transform': 'scale(' + scale + ')',
                            'opacity': opacity
                        });
                    },
                    duration: 800,
                    complete: function() {
                        current_fs.hide();
                        animating = false;
                    },
                    //this comes from the custom easing plugin
                    easing: 'easeInOutBack'
                });
            });

            // $(".submit").click(function(){
            // 	return false;
            // });



        });
        </script>
    </body>

</html>
